<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
</head>

<body>
  <script type="text/javascript">
    // speak.js
    var tts = {};

    tts.say = function (text) {
      var lang = "zh-CN";
      var voice = window.speechSynthesis.getVoices().filter(function (voice) {
        return voice.lang === lang;
      })[0]

      var utterance = new SpeechSynthesisUtterance();
      utterance.voice = voice;
      utterance.lang = lang;

      utterance.text = text;
      window.speechSynthesis.speak(utterance);
    }


    // _dictate.js

    var dictate = function (words, options) {
      var _dictate = {
        words: words.slice(0),
        options: options,
        _timeoutID: null,

        start: function () {
          // tts.say("即将进行听写，请做好准备！");
          this._timeoutID = window.setTimeout(function (that) {
            that.read(1)
          }, this.options.wordInterval, this)
        },

        pause: function(){
          if(this._timeoutID !== null){
            window.clearTimeout(this._timeoutID);
          }
        },

        read: function (times) {
          if (this.words.length === 0) {
            return;
          } else if (times === this.options.repeat) {
            tts.say(this.words[0]);
            this.words.shift();
            this._timeoutID = window.setTimeout(function (that) {
              that.read(1)
            }, this.options.wordInterval, this)
          } else {
            tts.say(this.words[0]);
            this._timeoutID = window.setTimeout(function (that) {
              that.read(times + 1)
            }, this.words[0].length * this.options.repeatInterval, this)
          }
        },

      };

      return _dictate;
    }


    var words = ["中国", "江苏省", "连云港市"];
    var options = {
      repeat: 2,
      repeatInterval: 1000,
      wordInterval: 2000,
    };


    // dictate(words, options).start();
  </script>
</body>

</html>